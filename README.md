# FeedApp

![example workflow](https://github.com/P1T1B0Y98/FeedApp/actions/workflows/dotnet.yml/badge.svg)                                                         ![example workflow](https://github.com/P1T1B0Y98/FeedApp/actions/workflows/node.js.yml/badge.svg) 

DAT250 project in which we were to create an API, a frontend and integration with messaging services and IoT-devices for an application which allows a user to create polls (with yes/no votes), vote on polls and manage polls.

The application is deployed to Azure, with the backend hosted as an App service and the frontend as a static web page:
- [Deployed API](https://feedapplication.azurewebsites.net/swagger/index.html)
- [Deployed frontend](https://feedapp.spectraldev.tech/) (subject to change, I intend to rewrite this in React following responsive design concepts so it actually displays well on mobile devices as well)

Technology stack:
### Backend
- C# project in .NET
- ASP.NET Core
- EntityFrameworkCore
- PostgreSQL - Used for storing all persistent data such as users, polls, votes, etc. 
- RabbitMQ - Messaging service used to publish information to dweet.io
- MongoDB - Used for storing information about closed polls
- [IdGen](https://github.com/RobThree/IdGen) - Short unique IDs for polls, where inputting a Guid would be inconvenient.
- Guid - Unique identifiers used for everything other than polls.
- [MediatR](https://github.com/jbogard/MediatR) - Open source mediator library used for async in-process messaging.
- [Sgbj.CronTimer](https://www.nuget.org/packages/Sgbj.Cron.CronTimer) - Cron timer used for running tasks on intervals. 





___
# Building this project
## Using .net backend
### Software needed
- Visual Studio (or other IDE of your choice)
- Postgresql

### Setting up Visual Studio
Download [Visual Studio Community Edition](https://visualstudio.microsoft.com/). When installing you will be prompted to install extra features, I installed the  ASP.NET and web development pack but I believe you can skip this for now and only download the required dependencies in the next step.

Select Open a project or solution (or clone a repository if you haven't already) and locate the FeedApp.sln file in the Backend folder and open it. If you try to run the project now you will get errors about missing dependencies. To fix this go to Tools -> NuGet Package Manager -> Package Manager Settings then click on Package Sources on the left. Press [+] and add `Name: nuget.org` and `Source: https://api.nuget.org/v3/index.json` and click ok. If you now try to run the program via the ▶️FeedApp button on the top toolbar it will install all required dependencies then launch. 

Launching the program will by default open an autogenerated Swagger page at https://localhost:7280/swagger/index.html which in some browsers is flagged as potentially unsafe (at least Firefox), in which case you will have to allow loading the page in your browser in order to use the Swagger ui to test the api (note that the API is still running even if you dont do this, so you can use it via other tools such as postman). 

### Configuring postgresql
To configure the postgresql database i use [pgAdmin](https://www.pgadmin.org/) which should be installed with postgresql, however you can use the command line if you prefer. Create a new database and call it FeedApp.
If you open the API project and click on Connected Services you will see Secrets.json (Local) in service dependencies, click the ... on the right and Manage User Secrets. Here you want to configure the path to your postgresql database.
An example of how it should look:
```json
{
  "ConnectionStrings:ConnectionString": "Server=localhost;Database=FeedApp;Port=5432;User Id=postgres;Password=1234;Ssl Mode=Prefer; Trust Server Certificate=true"
}
```
The last step is to open Tools -> NuGet Package Manager -> Package Manager Console and doing the following two commands:

`dotnet tool install --global dotnet-ef`

`dotnet ef database update --project Database --startup-project API`

Now you should be able to test all the endpoints after launching the app.

### Authenticating swagger
Some endpoints require the user to be logged in to access them, to do so you must first create a user, then log in to that user with the /api/user/login endpoint. This returns a JWT which you need to copy to your clipboard. Go to the top of the page and click Authorize and paste the JWT you got. This token is valid for 30 minutes as of writing this, but you can alter this in API/appsettings.json and changing the expiresIn field under JwtConfig (then saving and restarting the application).
